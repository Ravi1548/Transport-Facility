<div class="search-rides-container">
  <div class="header">
    <h1>Available Rides</h1>
    <p class="subtitle">Find and book rides for today</p>
  </div>


  <div *ngIf="showBookingAlert" class="alert" [ngClass]="bookingSuccess ? 'alert-success' : 'alert-error'">
    <i [class]="bookingSuccess ? 'icon-success' : 'icon-error'"></i>
    <span>{{ bookingMessage }}</span>
    <button class="alert-close" (click)="closeAlert()">&times;</button>
  </div>

  <div class="tabs-container">
    <div class="tabs">
      <button 
        class="tab-btn" 
        [class.active]="activeTab === 'available'"
        (click)="setActiveTab('available')"
      >
        <i class="icon-search"></i>
        Available Rides
        <span class="tab-count">{{ availableRides.length }}</span>
      </button>
      <button 
        class="tab-btn" 
        [class.active]="activeTab === 'booked'"
        (click)="setActiveTab('booked')"
      >
        <i class="icon-booked"></i>
        My Bookings
        <span class="tab-count">{{ bookedRides.length }}</span>
      </button>
      <button 
        class="tab-btn" 
        [class.active]="activeTab === 'myrides'"
        (click)="setActiveTab('myrides')"
      >
        <i class="icon-car"></i>
        My Rides
        <span class="tab-count">{{ myRides.length }}</span>
      </button>
    </div>
  </div>

  <div class="search-filters" *ngIf="activeTab === 'available'">
    <form [formGroup]="searchForm" class="filter-form">
      <div class="filter-group">
        <label for="searchTime">Search by Time</label>
        <input
          type="time"
          id="searchTime"
          formControlName="searchTime"
          placeholder="Filter by departure time"
        />
        <small class="help-text">Shows rides within ±60 minutes</small>
      </div>

      <div class="filter-group">
        <label for="vehicleType">Vehicle Type</label>
        <select id="vehicleType" formControlName="vehicleType">
          <option value="">All Vehicles</option>
          <option value="Bike">Bike</option>
          <option value="Car">Car</option>
        </select>
      </div>

      <div class="filter-actions">
        <button type="button" class="btn btn-secondary" (click)="clearFilters()">
          Clear Filters
        </button>
      </div>
    </form>
  </div>

  <div *ngIf="isLoading" class="loading">
    <div class="spinner-large"></div>
    <p>Loading available rides...</p>
  </div>

  <div *ngIf="!isLoading && getCurrentRides().length === 0" class="no-rides">
    <div class="no-rides-icon">
      <span *ngIf="activeTab === 'available'"></span>
      <span *ngIf="activeTab === 'booked'"></span>
      <span *ngIf="activeTab === 'myrides'"></span>
    </div>
    <h3 *ngIf="activeTab === 'available'">No rides available</h3>
    <h3 *ngIf="activeTab === 'booked'">No bookings yet</h3>
    <h3 *ngIf="activeTab === 'myrides'">No rides created</h3>
    
    <p *ngIf="activeTab === 'available' && availableRides.length === 0">No rides have been added for today yet.</p>
    <p *ngIf="activeTab === 'available' && availableRides.length > 0">Try adjusting your search filters.</p>
    <p *ngIf="activeTab === 'booked'">You haven't booked any rides yet. Check available rides to book one.</p>
    <p *ngIf="activeTab === 'myrides'">You haven't created any rides yet.</p>
    
    <button class="btn btn-primary" (click)="goToAddRide()">
      <i class="icon-plus"></i>
      Add New Ride
    </button>
  </div>

  <div *ngIf="!isLoading && getCurrentRides().length > 0" class="rides-list">
    <div class="rides-header">
      <h3 *ngIf="activeTab === 'available'">{{ getCurrentRides().length }} available ride(s)</h3>
      <h3 *ngIf="activeTab === 'booked'">{{ getCurrentRides().length }} booked ride(s)</h3>
      <h3 *ngIf="activeTab === 'myrides'">{{ getCurrentRides().length }} your ride(s)</h3>
    </div>

    <div class="rides-grid">
      <div *ngFor="let ride of getCurrentRides()" class="ride-card">
        <div class="ride-header">
          <div class="vehicle-info">
            <span class="vehicle-type" [class]="'vehicle-' + ride.vehicleType.toLowerCase()">
              {{ ride.vehicleType }}
            </span>
            <span class="vehicle-number">{{ ride.vehicleNo }}</span>
          </div>
          <div class="ride-time">
            {{ formatTime(ride.time) }}
          </div>
        </div>

        <div class="ride-route">
          <div class="route-point pickup">
            <i class="icon-pickup"></i>
            <div>
              <label>Pickup</label>
              <span>{{ ride.pickupPoint }}</span>
            </div>
          </div>
          <div class="route-arrow">→</div>
          <div class="route-point destination">
            <i class="icon-destination"></i>
            <div>
              <label>Destination</label>
              <span>{{ ride.destination }}</span>
            </div>
          </div>
        </div>

        <div class="ride-details">
          <div class="detail-item">
            <i class="icon-user"></i>
            <span>Driver: {{ ride.employeeId }}</span>
          </div>
          <div class="detail-item">
            <i class="icon-seats"></i>
            <span>{{ ride.vacantSeats }} seat(s) available</span>
          </div>
          <div class="detail-item" *ngIf="ride.bookedBy.length > 0">
            <i class="icon-booked"></i>
            <span>{{ ride.bookedBy.length }} booking(s)</span>
          </div>
        </div>

        <div class="ride-actions">
          <div class="ride-status" [ngClass]="'status-' + getRideStatus(ride).toLowerCase().replace(' ', '-').replace(' ', '-').replace(' ', '-')">
            {{ getRideStatus(ride) }}
          </div>
          
          <button
            *ngIf="activeTab === 'available' && canBookRide(ride)"
            class="btn btn-primary btn-book"
            (click)="bookRide(ride)"
          >
            <i class="icon-book"></i>
            Book Ride
          </button>
          
          <button
            *ngIf="activeTab === 'booked' && canCancelBooking(ride)"
            class="btn btn-danger btn-cancel"
            (click)="cancelBooking(ride)"
          >
            <i class="icon-cancel"></i>
            Cancel Booking
          </button>
          
          <div *ngIf="activeTab === 'myrides'" class="ride-info">
            <span class="passengers-info">
              <i class="icon-passengers"></i>
              {{ ride.bookedBy.length }} passenger(s)
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>